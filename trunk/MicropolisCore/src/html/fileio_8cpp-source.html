<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Micropolis: MicropolisEngine/src/fileio.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>MicropolisEngine/src/fileio.cpp</h1><a href="fileio_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* fileio.cpp</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * Micropolis, Unix Version.  This game was released for the Unix platform</span>
<a name="l00004"></a>00004 <span class="comment"> * in or about 1990 and has been modified for inclusion in the One Laptop</span>
<a name="l00005"></a>00005 <span class="comment"> * Per Child program.  Copyright (C) 1989 - 2007 Electronic Arts Inc.  If</span>
<a name="l00006"></a>00006 <span class="comment"> * you need assistance with this program, you may contact:</span>
<a name="l00007"></a>00007 <span class="comment"> *   http://wiki.laptop.org/go/Micropolis  or email  micropolis@laptop.org.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is free software: you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00011"></a>00011 <span class="comment"> * the Free Software Foundation, either version 3 of the License, or (at</span>
<a name="l00012"></a>00012 <span class="comment"> * your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00015"></a>00015 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00017"></a>00017 <span class="comment"> * General Public License for more details.  You should have received a</span>
<a name="l00018"></a>00018 <span class="comment"> * copy of the GNU General Public License along with this program.  If</span>
<a name="l00019"></a>00019 <span class="comment"> * not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> *             ADDITIONAL TERMS per GNU GPL Section 7</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * No trademark or publicity rights are granted.  This license does NOT</span>
<a name="l00024"></a>00024 <span class="comment"> * give you any right, title or interest in the trademark SimCity or any</span>
<a name="l00025"></a>00025 <span class="comment"> * other Electronic Arts trademark.  You may not distribute any</span>
<a name="l00026"></a>00026 <span class="comment"> * modification of this program using the trademark SimCity or claim any</span>
<a name="l00027"></a>00027 <span class="comment"> * affliation or association with Electronic Arts Inc. or its employees.</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> * Any propagation or conveyance of this program must include this</span>
<a name="l00030"></a>00030 <span class="comment"> * copyright notice and these terms.</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> * If you convey this program (or any modifications of it) and assume</span>
<a name="l00033"></a>00033 <span class="comment"> * contractual liability for the program to recipients of it, you agree</span>
<a name="l00034"></a>00034 <span class="comment"> * to indemnify Electronic Arts for any liability that those contractual</span>
<a name="l00035"></a>00035 <span class="comment"> * assumptions impose on Electronic Arts.</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> * You may not misrepresent the origins of this program; modified</span>
<a name="l00038"></a>00038 <span class="comment"> * versions of the program must be marked as such and not identified as</span>
<a name="l00039"></a>00039 <span class="comment"> * the original program.</span>
<a name="l00040"></a>00040 <span class="comment"> *</span>
<a name="l00041"></a>00041 <span class="comment"> * This disclaimer supplements the one included in the General Public</span>
<a name="l00042"></a>00042 <span class="comment"> * License.  TO THE FULLEST EXTENT PERMISSIBLE UNDER APPLICABLE LAW, THIS</span>
<a name="l00043"></a>00043 <span class="comment"> * PROGRAM IS PROVIDED TO YOU "AS IS," WITH ALL FAULTS, WITHOUT WARRANTY</span>
<a name="l00044"></a>00044 <span class="comment"> * OF ANY KIND, AND YOUR USE IS AT YOUR SOLE RISK.  THE ENTIRE RISK OF</span>
<a name="l00045"></a>00045 <span class="comment"> * SATISFACTORY QUALITY AND PERFORMANCE RESIDES WITH YOU.  ELECTRONIC ARTS</span>
<a name="l00046"></a>00046 <span class="comment"> * DISCLAIMS ANY AND ALL EXPRESS, IMPLIED OR STATUTORY WARRANTIES,</span>
<a name="l00047"></a>00047 <span class="comment"> * INCLUDING IMPLIED WARRANTIES OF MERCHANTABILITY, SATISFACTORY QUALITY,</span>
<a name="l00048"></a>00048 <span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE, NONINFRINGEMENT OF THIRD PARTY</span>
<a name="l00049"></a>00049 <span class="comment"> * RIGHTS, AND WARRANTIES (IF ANY) ARISING FROM A COURSE OF DEALING,</span>
<a name="l00050"></a>00050 <span class="comment"> * USAGE, OR TRADE PRACTICE.  ELECTRONIC ARTS DOES NOT WARRANT AGAINST</span>
<a name="l00051"></a>00051 <span class="comment"> * INTERFERENCE WITH YOUR ENJOYMENT OF THE PROGRAM; THAT THE PROGRAM WILL</span>
<a name="l00052"></a>00052 <span class="comment"> * MEET YOUR REQUIREMENTS; THAT OPERATION OF THE PROGRAM WILL BE</span>
<a name="l00053"></a>00053 <span class="comment"> * UNINTERRUPTED OR ERROR-FREE, OR THAT THE PROGRAM WILL BE COMPATIBLE</span>
<a name="l00054"></a>00054 <span class="comment"> * WITH THIRD PARTY SOFTWARE OR THAT ANY ERRORS IN THE PROGRAM WILL BE</span>
<a name="l00055"></a>00055 <span class="comment"> * CORRECTED.  NO ORAL OR WRITTEN ADVICE PROVIDED BY ELECTRONIC ARTS OR</span>
<a name="l00056"></a>00056 <span class="comment"> * ANY AUTHORIZED REPRESENTATIVE SHALL CREATE A WARRANTY.  SOME</span>
<a name="l00057"></a>00057 <span class="comment"> * JURISDICTIONS DO NOT ALLOW THE EXCLUSION OF OR LIMITATIONS ON IMPLIED</span>
<a name="l00058"></a>00058 <span class="comment"> * WARRANTIES OR THE LIMITATIONS ON THE APPLICABLE STATUTORY RIGHTS OF A</span>
<a name="l00059"></a>00059 <span class="comment"> * CONSUMER, SO SOME OR ALL OF THE ABOVE EXCLUSIONS AND LIMITATIONS MAY</span>
<a name="l00060"></a>00060 <span class="comment"> * NOT APPLY TO YOU.</span>
<a name="l00061"></a>00061 <span class="comment"> */</span>
<a name="l00062"></a>00062 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="preprocessor">#include "stdafx.h"</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include "<a class="code" href="micropolis_8h.html">micropolis.h</a>"</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="preprocessor">#ifdef IS_INTEL</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00082"></a><a class="code" href="fileio_8cpp.html#e04205d57b6534c324a5df791a2d0e58">00082</a> <span class="preprocessor">#define SWAP_SHORTS(buf, len)        swap_shorts(buf, len)</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>
<a name="l00089"></a><a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">00089</a> <span class="preprocessor">#define HALF_SWAP_LONGS(buf, len)    half_swap_longs(buf, len)</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00096"></a><a class="code" href="fileio_8cpp.html#99c680c6be1f38eac86f02b53fc68bba">00096</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fileio_8cpp.html#99c680c6be1f38eac86f02b53fc68bba">swap_shorts</a>(<span class="keywordtype">short</span> *buf, <span class="keywordtype">int</span> len)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098     <span class="keywordtype">int</span> i;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <span class="comment">/* Flip bytes in each short! */</span>
<a name="l00101"></a>00101     <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {
<a name="l00102"></a>00102         *buf = ((*buf &amp; 0xFF) &lt;&lt;8) | ((*buf &amp;0xFF00) &gt;&gt;8);
<a name="l00103"></a>00103         buf++;
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 
<a name="l00113"></a><a class="code" href="fileio_8cpp.html#4b17287d1f022775b63676246135cbe5">00113</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fileio_8cpp.html#4b17287d1f022775b63676246135cbe5">half_swap_longs</a>(<span class="keywordtype">long</span> *buf, <span class="keywordtype">int</span> len)
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115     <span class="keywordtype">int</span> i;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="comment">/* Flip bytes in each long! */</span>
<a name="l00118"></a>00118     <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {
<a name="l00119"></a>00119         <span class="keywordtype">long</span> l = *buf;
<a name="l00120"></a>00120         *buf =
<a name="l00121"></a>00121             ((l &amp; 0x0000ffff) &lt;&lt; 16) |
<a name="l00122"></a>00122             ((l &amp; 0xffff0000) &gt;&gt; 16);
<a name="l00123"></a>00123         buf++;
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="preprocessor">#else</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>
<a name="l00130"></a>00130 
<a name="l00138"></a>00138 <span class="preprocessor">#define SWAP_SHORTS(buf, len)</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>
<a name="l00147"></a>00147 <span class="preprocessor">#define HALF_SWAP_LONGS(buf, len)</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span>
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 <span class="preprocessor">#endif</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>
<a name="l00161"></a><a class="code" href="fileio_8cpp.html#4ab6d842aead283ab76b4b0005d92935">00161</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="fileio_8cpp.html#4ab6d842aead283ab76b4b0005d92935">load_short</a>(<span class="keywordtype">short</span> *buf, <span class="keywordtype">int</span> len, FILE *f)
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163     <span class="keywordtype">size_t</span> result = fread(buf, <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), len, f);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)result != len) {
<a name="l00166"></a>00166          <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <a class="code" href="fileio_8cpp.html#e04205d57b6534c324a5df791a2d0e58">SWAP_SHORTS</a>(buf, len);        <span class="comment">/* to intel */</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00172"></a>00172 }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 
<a name="l00184"></a><a class="code" href="fileio_8cpp.html#ed90fcee5afee0dab5cf96a87cadb233">00184</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="fileio_8cpp.html#ed90fcee5afee0dab5cf96a87cadb233">save_short</a>(<span class="keywordtype">short</span> *buf, <span class="keywordtype">int</span> len, FILE *f)
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186     <a class="code" href="fileio_8cpp.html#e04205d57b6534c324a5df791a2d0e58">SWAP_SHORTS</a>(buf, len);        <span class="comment">/* to MAC */</span>
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)fwrite(buf, <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), len, f) != len) {
<a name="l00189"></a>00189         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     <a class="code" href="fileio_8cpp.html#e04205d57b6534c324a5df791a2d0e58">SWAP_SHORTS</a>(buf, len);        <span class="comment">/* back to intel */</span>
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00203"></a><a class="code" href="classMicropolis.html#dbc19c162ac05f3ab6f536274a4b7547">00203</a> <span class="keywordtype">bool</span> <a class="code" href="classMicropolis.html#dbc19c162ac05f3ab6f536274a4b7547">Micropolis::loadFileDir</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keyword">const</span> <span class="keywordtype">char</span> *dir)
<a name="l00204"></a>00204 {
<a name="l00205"></a>00205     <span class="keywordtype">char</span> *path = NULL;
<a name="l00206"></a>00206     FILE *f;
<a name="l00207"></a>00207     Quad size;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     <span class="comment">// If needed, construct a path to the file.</span>
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (dir != NULL) {
<a name="l00211"></a>00211         path = (<span class="keywordtype">char</span> *)malloc(strlen(dir) + 1 + strlen(filename) + 1);
<a name="l00212"></a>00212         sprintf(path, <span class="stringliteral">"%s/%s"</span>, dir, filename);
<a name="l00213"></a>00213         filename = path;
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     <span class="comment">// Open the file.</span>
<a name="l00217"></a>00217     f = fopen(filename, <span class="stringliteral">"rb"</span>);
<a name="l00218"></a>00218 
<a name="l00219"></a>00219     <span class="comment">// Before checking whether open() succeeded, first drop the path.</span>
<a name="l00220"></a>00220     <span class="keywordflow">if</span> (path != NULL) {
<a name="l00221"></a>00221         free(path);
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="comment">// open() failed; report failure.</span>
<a name="l00225"></a>00225     <span class="keywordflow">if</span> (f == NULL) {
<a name="l00226"></a>00226         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     fseek(f, 0L, SEEK_END);
<a name="l00230"></a>00230     size = ftell(f);
<a name="l00231"></a>00231     fseek(f, 0L, SEEK_SET);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <span class="keywordtype">bool</span> result =
<a name="l00234"></a>00234       (size == 27120) &amp;&amp;
<a name="l00235"></a>00235       <a class="code" href="fileio_8cpp.html#4ab6d842aead283ab76b4b0005d92935">load_short</a>(<a class="code" href="classMicropolis.html#3aa2fd8af4ad557830a8c9677ded44f3">resHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), f) &amp;&amp;
<a name="l00236"></a>00236       <a class="code" href="fileio_8cpp.html#4ab6d842aead283ab76b4b0005d92935">load_short</a>(<a class="code" href="classMicropolis.html#af42284eb1c7f337fd3eadd6ecb57ae9">comHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), f) &amp;&amp;
<a name="l00237"></a>00237       <a class="code" href="fileio_8cpp.html#4ab6d842aead283ab76b4b0005d92935">load_short</a>(<a class="code" href="classMicropolis.html#a8b3a322fafd536d0321829744bea508">indHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), f) &amp;&amp;
<a name="l00238"></a>00238       <a class="code" href="fileio_8cpp.html#4ab6d842aead283ab76b4b0005d92935">load_short</a>(<a class="code" href="classMicropolis.html#8013d2fc2b5163a68d032775235d10e4">crimeHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), f) &amp;&amp;
<a name="l00239"></a>00239       <a class="code" href="fileio_8cpp.html#4ab6d842aead283ab76b4b0005d92935">load_short</a>(<a class="code" href="classMicropolis.html#8018b7f8abc1d78e953ce4d617a8e07f">pollutionHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), f) &amp;&amp;
<a name="l00240"></a>00240       <a class="code" href="fileio_8cpp.html#4ab6d842aead283ab76b4b0005d92935">load_short</a>(<a class="code" href="classMicropolis.html#528303a1a67ab43c8bf96bcc07935e1c">moneyHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), f) &amp;&amp;
<a name="l00241"></a>00241       <a class="code" href="fileio_8cpp.html#4ab6d842aead283ab76b4b0005d92935">load_short</a>(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>, <a class="code" href="micropolis_8h.html#d39cb42a7b73d0ef7b058baca8a02d6f">MISC_HISTORY_LENGTH</a> / <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), f) &amp;&amp;
<a name="l00242"></a>00242       <a class="code" href="fileio_8cpp.html#4ab6d842aead283ab76b4b0005d92935">load_short</a>(((<span class="keywordtype">short</span> *)&amp;<a class="code" href="classMicropolis.html#9caa2dda6edc913f82c4c48c77ae7859">map</a>[0][0]), <a class="code" href="map__type_8h.html#e6df22d5005e60ca7b2da133fcff3c24">WORLD_W</a> * <a class="code" href="map__type_8h.html#d649289f6f5a81082f7cceae8b94d137">WORLD_H</a>, f);
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     fclose(f);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="keywordflow">return</span> result;
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00254"></a><a class="code" href="classMicropolis.html#a15ca2a508026c76965ceefcf01fdd8b">00254</a> <span class="keywordtype">bool</span> <a class="code" href="classMicropolis.html#a15ca2a508026c76965ceefcf01fdd8b">Micropolis::loadFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)
<a name="l00255"></a>00255 {
<a name="l00256"></a>00256     <span class="keywordtype">long</span> n;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     <span class="keywordflow">if</span> (!<a class="code" href="classMicropolis.html#dbc19c162ac05f3ab6f536274a4b7547">loadFileDir</a>(filename, NULL)) {
<a name="l00259"></a>00259         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="comment">/* total funds is a long.....    miscHist is array of shorts */</span>
<a name="l00263"></a>00263     <span class="comment">/* total funds is being put in the 50th &amp; 51th word of miscHist */</span>
<a name="l00264"></a>00264     <span class="comment">/* find the address, cast the ptr to a longPtr, take contents */</span>
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     n = *(Quad *)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 50);
<a name="l00267"></a>00267     <a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">HALF_SWAP_LONGS</a>(&amp;n, 1);
<a name="l00268"></a>00268     <a class="code" href="classMicropolis.html#85129802f6c58308373d25ae06b20181">setFunds</a>(n);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     n = *(Quad *)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 8);
<a name="l00271"></a>00271     <a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">HALF_SWAP_LONGS</a>(&amp;n, 1);
<a name="l00272"></a>00272     <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a> = n;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <a class="code" href="classMicropolis.html#8e95cce4bd06616588943dcfbbd54f58">setAutoBulldoze</a>(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[52] != 0);   <span class="comment">// flag for autoBulldoze</span>
<a name="l00275"></a>00275     <a class="code" href="classMicropolis.html#ff9ec6007fcc441982e21fd9164d4567">setAutoBudget</a>(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[53] != 0);     <span class="comment">// flag for autoBudget</span>
<a name="l00276"></a>00276     <a class="code" href="classMicropolis.html#608f88beddf09330c8a416bfc9614287">setAutoGoto</a>(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[54] != 0);       <span class="comment">// flag for auto-goto</span>
<a name="l00277"></a>00277     <a class="code" href="classMicropolis.html#8fb42f8c13b003fcb72fc100922a0cb0">setEnableSound</a>(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[55] != 0);    <span class="comment">// flag for the sound on/off</span>
<a name="l00278"></a>00278     setCityTax(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[56]);
<a name="l00279"></a>00279     setSpeed(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[57]);
<a name="l00280"></a>00280     <a class="code" href="classMicropolis.html#3ce8917c2032102a76c8f437a4fb6a3b">changeCensus</a>();
<a name="l00281"></a>00281     <a class="code" href="classMicropolis.html#90e10432e33bba0f5251b5457c7c4151" title="Options displayed at user need updating.">mustUpdateOptions</a> = <span class="keyword">true</span>;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <span class="comment">/* yayaya */</span>
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     n = *(Quad *)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 58);
<a name="l00286"></a>00286     <a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">HALF_SWAP_LONGS</a>(&amp;n, 1);
<a name="l00287"></a>00287     <a class="code" href="classMicropolis.html#f20de4d2d143903574a9b2530440f2fc">policePercent</a> = ((float)n) / ((float)65536);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     n = *(Quad *)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 60);
<a name="l00290"></a>00290     <a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">HALF_SWAP_LONGS</a>(&amp;n, 1);
<a name="l00291"></a>00291     <a class="code" href="classMicropolis.html#0d70c3d19b5abc8a76ecfc0fbdab8ff3">firePercent</a> = (float)n / (<span class="keywordtype">float</span>)65536.0;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     n = *(Quad *)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 62);
<a name="l00294"></a>00294     <a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">HALF_SWAP_LONGS</a>(&amp;n, 1);
<a name="l00295"></a>00295     <a class="code" href="classMicropolis.html#57e56232060b7facd86d938a1d19671f">roadPercent</a> = (float)n / (<span class="keywordtype">float</span>)65536.0;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <a class="code" href="classMicropolis.html#f20de4d2d143903574a9b2530440f2fc">policePercent</a> =
<a name="l00298"></a>00298         (float)(*(Quad*)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 58)) /
<a name="l00299"></a>00299         (float)65536.0;   <span class="comment">/* and 59 */</span>
<a name="l00300"></a>00300     <a class="code" href="classMicropolis.html#0d70c3d19b5abc8a76ecfc0fbdab8ff3">firePercent</a> =
<a name="l00301"></a>00301         (float)(*(Quad*)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 60)) /
<a name="l00302"></a>00302         (float)65536.0;   <span class="comment">/* and 61 */</span>
<a name="l00303"></a>00303     <a class="code" href="classMicropolis.html#57e56232060b7facd86d938a1d19671f">roadPercent</a> =
<a name="l00304"></a>00304         (float)(*(Quad*)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 62)) /
<a name="l00305"></a>00305         (float)65536.0;   <span class="comment">/* and 63 */</span>
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a> = <a class="code" href="micropolis_8h.html#8f8a8e07c572999f802bb4c74d2a0529">max</a>((Quad)0, <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a>);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="comment">// If the tax is nonsensical, set it to a reasonable value.</span>
<a name="l00310"></a>00310     <span class="keywordflow">if</span> (<a class="code" href="classMicropolis.html#e30007117c3d96ae144aa55efd9c7a68">cityTax</a> &gt; 20 || <a class="code" href="classMicropolis.html#e30007117c3d96ae144aa55efd9c7a68">cityTax</a> &lt; 0) {
<a name="l00311"></a>00311         setCityTax(7);
<a name="l00312"></a>00312     }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="comment">// If the speed is nonsensical, set it to a reasonable value.</span>
<a name="l00315"></a>00315     <span class="keywordflow">if</span> (simSpeed &lt; 0 || simSpeed &gt; 3) {
<a name="l00316"></a>00316         setSpeed(3);
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     setSpeed(simSpeed);
<a name="l00320"></a>00320     setPasses(1);
<a name="l00321"></a>00321     initFundingLevel();
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="comment">// Set the scenario id to 0.</span>
<a name="l00324"></a>00324     <a class="code" href="classMicropolis.html#db7f55e6134a7f9a5224facf9dc51c6c">initWillStuff</a>();
<a name="l00325"></a>00325     <a class="code" href="classMicropolis.html#2ef685b0d3c202a6d03e62d6d745449b" title="Scenario being played.">scenario</a> = <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07d0d3ea8a4184c0484369c12517741b315" title="No scenario (free playing).">SC_NONE</a>;
<a name="l00326"></a>00326     initSimLoad = 1;
<a name="l00327"></a>00327     <a class="code" href="classMicropolis.html#0fc9175e49a0b73af99ff1252fe1cf5c" title="Need to perform initial city evaluation.">doInitialEval</a> = <span class="keyword">false</span>;
<a name="l00328"></a>00328     <a class="code" href="classMicropolis.html#fe8a202062ffa639e0f0a77df48c7b42">doSimInit</a>();
<a name="l00329"></a>00329     <a class="code" href="classMicropolis.html#ca92337e6e069e3ca61396b0e2604d8e">invalidateMaps</a>();
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 
<a name="l00340"></a><a class="code" href="classMicropolis.html#6b81a4a5dda6fa2b37c0e3a744ffd94d">00340</a> <span class="keywordtype">bool</span> <a class="code" href="classMicropolis.html#6b81a4a5dda6fa2b37c0e3a744ffd94d">Micropolis::saveFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)
<a name="l00341"></a>00341 {
<a name="l00342"></a>00342     <span class="keywordtype">long</span> n;
<a name="l00343"></a>00343     FILE *f;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="keywordflow">if</span> ((f = fopen(filename, <span class="stringliteral">"wb"</span>)) == NULL) {
<a name="l00347"></a>00347         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00348"></a>00348     }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="comment">/* total funds is a long.....    miscHist is array of ints */</span>
<a name="l00351"></a>00351     <span class="comment">/* total funds is bien put in the 50th &amp; 51th word of miscHist */</span>
<a name="l00352"></a>00352     <span class="comment">/* find the address, cast the ptr to a longPtr, take contents */</span>
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     n = <a class="code" href="classMicropolis.html#f3535000ff4852f4e5809935576d8369" title="Funds of the player.">totalFunds</a>;
<a name="l00355"></a>00355     <a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">HALF_SWAP_LONGS</a>(&amp;n, 1);
<a name="l00356"></a>00356     (*(Quad *)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 50)) = n;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     n = <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a>;
<a name="l00359"></a>00359     <a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">HALF_SWAP_LONGS</a>(&amp;n, 1);
<a name="l00360"></a>00360     (*(Quad *)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 8)) = n;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[52] = <a class="code" href="classMicropolis.html#fd389464112d08c4a01d3da05c15890b">autoBulldoze</a>;   <span class="comment">// flag for autoBulldoze</span>
<a name="l00363"></a>00363     <a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[53] = <a class="code" href="classMicropolis.html#bbe8cd05a48ee183eeb607c0d019d616">autoBudget</a>;     <span class="comment">// flag for autoBudget</span>
<a name="l00364"></a>00364     <a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[54] = <a class="code" href="classMicropolis.html#dd98248d5b5b6fca81e169b8e06e3b22">autoGoto</a>;       <span class="comment">// flag for auto-goto</span>
<a name="l00365"></a>00365     <a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[55] = <a class="code" href="classMicropolis.html#b3271452ac81e5fcc46a663941ee36ab" title="Enable sound.">enableSound</a>;    <span class="comment">// flag for the sound on/off</span>
<a name="l00366"></a>00366     <a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[57] = simSpeed;
<a name="l00367"></a>00367     <a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>[56] = <a class="code" href="classMicropolis.html#e30007117c3d96ae144aa55efd9c7a68">cityTax</a>;        <span class="comment">/* post release */</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369     <span class="comment">/* yayaya */</span>
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     n = (int)(<a class="code" href="classMicropolis.html#f20de4d2d143903574a9b2530440f2fc">policePercent</a> * 65536);
<a name="l00372"></a>00372     <a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">HALF_SWAP_LONGS</a>(&amp;n, 1);
<a name="l00373"></a>00373     (*(Quad *)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 58)) = n;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     n = (int)(<a class="code" href="classMicropolis.html#0d70c3d19b5abc8a76ecfc0fbdab8ff3">firePercent</a> * 65536);
<a name="l00376"></a>00376     <a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">HALF_SWAP_LONGS</a>(&amp;n, 1);
<a name="l00377"></a>00377     (*(Quad *)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 60)) = n;
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     n = (int)(<a class="code" href="classMicropolis.html#57e56232060b7facd86d938a1d19671f">roadPercent</a> * 65536);
<a name="l00380"></a>00380     <a class="code" href="fileio_8cpp.html#576782b63ea50a2a9a2b371200ab1929">HALF_SWAP_LONGS</a>(&amp;n, 1);
<a name="l00381"></a>00381     (*(Quad *)(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a> + 62)) = n;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="keywordtype">bool</span> result =
<a name="l00384"></a>00384         <a class="code" href="fileio_8cpp.html#ed90fcee5afee0dab5cf96a87cadb233">save_short</a>(<a class="code" href="classMicropolis.html#3aa2fd8af4ad557830a8c9677ded44f3">resHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / 2, f) &amp;&amp;
<a name="l00385"></a>00385         <a class="code" href="fileio_8cpp.html#ed90fcee5afee0dab5cf96a87cadb233">save_short</a>(<a class="code" href="classMicropolis.html#af42284eb1c7f337fd3eadd6ecb57ae9">comHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / 2, f) &amp;&amp;
<a name="l00386"></a>00386         <a class="code" href="fileio_8cpp.html#ed90fcee5afee0dab5cf96a87cadb233">save_short</a>(<a class="code" href="classMicropolis.html#a8b3a322fafd536d0321829744bea508">indHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / 2, f) &amp;&amp;
<a name="l00387"></a>00387         <a class="code" href="fileio_8cpp.html#ed90fcee5afee0dab5cf96a87cadb233">save_short</a>(<a class="code" href="classMicropolis.html#8013d2fc2b5163a68d032775235d10e4">crimeHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / 2, f) &amp;&amp;
<a name="l00388"></a>00388         <a class="code" href="fileio_8cpp.html#ed90fcee5afee0dab5cf96a87cadb233">save_short</a>(<a class="code" href="classMicropolis.html#8018b7f8abc1d78e953ce4d617a8e07f">pollutionHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / 2, f) &amp;&amp;
<a name="l00389"></a>00389         <a class="code" href="fileio_8cpp.html#ed90fcee5afee0dab5cf96a87cadb233">save_short</a>(<a class="code" href="classMicropolis.html#528303a1a67ab43c8bf96bcc07935e1c">moneyHist</a>, <a class="code" href="micropolis_8h.html#1b80ec2dc11101b69162f75c7b1aa3f2">HISTORY_LENGTH</a> / 2, f) &amp;&amp;
<a name="l00390"></a>00390         <a class="code" href="fileio_8cpp.html#ed90fcee5afee0dab5cf96a87cadb233">save_short</a>(<a class="code" href="classMicropolis.html#e8e96d1adb850155aa16958fda24ed7d">miscHist</a>, <a class="code" href="micropolis_8h.html#d39cb42a7b73d0ef7b058baca8a02d6f">MISC_HISTORY_LENGTH</a> / 2, f) &amp;&amp;
<a name="l00391"></a>00391         <a class="code" href="fileio_8cpp.html#ed90fcee5afee0dab5cf96a87cadb233">save_short</a>(((<span class="keywordtype">short</span> *)&amp;<a class="code" href="classMicropolis.html#9caa2dda6edc913f82c4c48c77ae7859">map</a>[0][0]), <a class="code" href="map__type_8h.html#e6df22d5005e60ca7b2da133fcff3c24">WORLD_W</a> * <a class="code" href="map__type_8h.html#d649289f6f5a81082f7cceae8b94d137">WORLD_H</a>, f);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     fclose(f);
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="keywordflow">return</span> result;
<a name="l00396"></a>00396 }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 
<a name="l00404"></a><a class="code" href="classMicropolis.html#5d09f77d02dd6856a6947fdd3fffb07e">00404</a> <span class="keywordtype">void</span> <a class="code" href="classMicropolis.html#5d09f77d02dd6856a6947fdd3fffb07e">Micropolis::loadScenario</a>(<a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07d">Scenario</a> s)
<a name="l00405"></a>00405 {
<a name="l00406"></a>00406     <span class="keyword">const</span> <span class="keywordtype">char</span> *name = NULL;
<a name="l00407"></a>00407     <span class="keyword">const</span> <span class="keywordtype">char</span> *fname = NULL;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a> = <span class="stringliteral">""</span>;
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <a class="code" href="classMicropolis.html#b8731570f5210acb35c3b17c789c13de">setGameLevel</a>(<a class="code" href="micropolis_8h.html#9d2c8df557e927eceec042cd07a5a948642b63fb61bba2e16236fc454fe12a1d" title="Simple game level.">LEVEL_EASY</a>);
<a name="l00412"></a>00412 
<a name="l00413"></a>00413     <span class="keywordflow">if</span> (s &lt; SC_DULLSVILLE || s &gt; <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07dbe530624b4bc94c70e387b6f9ed90c69" title="Rio (flooding).">SC_RIO</a>) {
<a name="l00414"></a>00414         s = <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07ddb1e3d79cd60f22c97f3dd66e552e688" title="Dullsville (boredom).">SC_DULLSVILLE</a>;
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     <span class="keywordflow">switch</span> (s) {
<a name="l00418"></a>00418         <span class="keywordflow">case</span> <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07ddb1e3d79cd60f22c97f3dd66e552e688" title="Dullsville (boredom).">SC_DULLSVILLE</a>:
<a name="l00419"></a>00419             name = <span class="stringliteral">"Dullsville"</span>;
<a name="l00420"></a>00420             fname = <span class="stringliteral">"snro.111"</span>;
<a name="l00421"></a>00421             <a class="code" href="classMicropolis.html#2ef685b0d3c202a6d03e62d6d745449b" title="Scenario being played.">scenario</a> = <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07ddb1e3d79cd60f22c97f3dd66e552e688" title="Dullsville (boredom).">SC_DULLSVILLE</a>;
<a name="l00422"></a>00422             <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a> = ((1900 - 1900) * 48) + 2;
<a name="l00423"></a>00423             <a class="code" href="classMicropolis.html#85129802f6c58308373d25ae06b20181">setFunds</a>(5000);
<a name="l00424"></a>00424             <span class="keywordflow">break</span>;
<a name="l00425"></a>00425         <span class="keywordflow">case</span> <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07db63927fdaa04882bb676aae27893d6a6" title="San francisco (earthquake).">SC_SAN_FRANCISCO</a>:
<a name="l00426"></a>00426             name = <span class="stringliteral">"San Francisco"</span>;
<a name="l00427"></a>00427             fname = <span class="stringliteral">"snro.222"</span>;
<a name="l00428"></a>00428             <a class="code" href="classMicropolis.html#2ef685b0d3c202a6d03e62d6d745449b" title="Scenario being played.">scenario</a> = <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07db63927fdaa04882bb676aae27893d6a6" title="San francisco (earthquake).">SC_SAN_FRANCISCO</a>;
<a name="l00429"></a>00429             <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a> = ((1906 - 1900) * 48) + 2;
<a name="l00430"></a>00430             <a class="code" href="classMicropolis.html#85129802f6c58308373d25ae06b20181">setFunds</a>(20000);
<a name="l00431"></a>00431             <span class="keywordflow">break</span>;
<a name="l00432"></a>00432         <span class="keywordflow">case</span> <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07dcbbe62ebb0760029a468376a2cf73133" title="Hamburg (fire bombs).">SC_HAMBURG</a>:
<a name="l00433"></a>00433             name = <span class="stringliteral">"Hamburg"</span>;
<a name="l00434"></a>00434             fname = <span class="stringliteral">"snro.333"</span>;
<a name="l00435"></a>00435             <a class="code" href="classMicropolis.html#2ef685b0d3c202a6d03e62d6d745449b" title="Scenario being played.">scenario</a> = <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07dcbbe62ebb0760029a468376a2cf73133" title="Hamburg (fire bombs).">SC_HAMBURG</a>;
<a name="l00436"></a>00436             <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a> = ((1944 - 1900) * 48) + 2;
<a name="l00437"></a>00437             <a class="code" href="classMicropolis.html#85129802f6c58308373d25ae06b20181">setFunds</a>(20000);
<a name="l00438"></a>00438             <span class="keywordflow">break</span>;
<a name="l00439"></a>00439         <span class="keywordflow">case</span> <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07d31c1a99ac0baa2361d8724907982aba4" title="Bern (traffic).">SC_BERN</a>:
<a name="l00440"></a>00440             name = <span class="stringliteral">"Bern"</span>;
<a name="l00441"></a>00441             fname = <span class="stringliteral">"snro.444"</span>;
<a name="l00442"></a>00442             <a class="code" href="classMicropolis.html#2ef685b0d3c202a6d03e62d6d745449b" title="Scenario being played.">scenario</a> = <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07d31c1a99ac0baa2361d8724907982aba4" title="Bern (traffic).">SC_BERN</a>;
<a name="l00443"></a>00443             <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a> = ((1965 - 1900) * 48) + 2;
<a name="l00444"></a>00444             <a class="code" href="classMicropolis.html#85129802f6c58308373d25ae06b20181">setFunds</a>(20000);
<a name="l00445"></a>00445             <span class="keywordflow">break</span>;
<a name="l00446"></a>00446         <span class="keywordflow">case</span> <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07d0189f7555a4432e703c60c55e0b9e744" title="Tokyo (scary monster).">SC_TOKYO</a>:
<a name="l00447"></a>00447             name = <span class="stringliteral">"Tokyo"</span>;
<a name="l00448"></a>00448             fname = <span class="stringliteral">"snro.555"</span>;
<a name="l00449"></a>00449             <a class="code" href="classMicropolis.html#2ef685b0d3c202a6d03e62d6d745449b" title="Scenario being played.">scenario</a> = <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07d0189f7555a4432e703c60c55e0b9e744" title="Tokyo (scary monster).">SC_TOKYO</a>;
<a name="l00450"></a>00450             <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a> = ((1957 - 1900) * 48) + 2;
<a name="l00451"></a>00451             <a class="code" href="classMicropolis.html#85129802f6c58308373d25ae06b20181">setFunds</a>(20000);
<a name="l00452"></a>00452             <span class="keywordflow">break</span>;
<a name="l00453"></a>00453         <span class="keywordflow">case</span> <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07df1e5e7c2428a01f7432ceaba30c7f579" title="Detroit (crime).">SC_DETROIT</a>:
<a name="l00454"></a>00454             name = <span class="stringliteral">"Detroit"</span>;
<a name="l00455"></a>00455             fname = <span class="stringliteral">"snro.666"</span>;
<a name="l00456"></a>00456             <a class="code" href="classMicropolis.html#2ef685b0d3c202a6d03e62d6d745449b" title="Scenario being played.">scenario</a> = <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07df1e5e7c2428a01f7432ceaba30c7f579" title="Detroit (crime).">SC_DETROIT</a>;
<a name="l00457"></a>00457             <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a> = ((1972 - 1900) * 48) + 2;
<a name="l00458"></a>00458             <a class="code" href="classMicropolis.html#85129802f6c58308373d25ae06b20181">setFunds</a>(20000);
<a name="l00459"></a>00459             <span class="keywordflow">break</span>;
<a name="l00460"></a>00460         <span class="keywordflow">case</span> <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07d2c4cd98133b60f5dbb238605c945f326" title="Boston (nuclear meltdown).">SC_BOSTON</a>:
<a name="l00461"></a>00461             name = <span class="stringliteral">"Boston"</span>;
<a name="l00462"></a>00462             fname = <span class="stringliteral">"snro.777"</span>;
<a name="l00463"></a>00463             <a class="code" href="classMicropolis.html#2ef685b0d3c202a6d03e62d6d745449b" title="Scenario being played.">scenario</a> = <a class="code" href="micropolis_8h.html#198c01cbf13aa7ce7b025ff7b7aba07d2c4cd98133b60f5dbb238605c945f326" title="Boston (nuclear meltdown).">SC_BOSTON</a>;
<a name="l00464"></a>00464             <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a> = ((2010 - 1900) * 48) + 2;
<a name="l00465"></a>00465             <a class="code" href="classMicropolis.html#85129802f6c58308373d25ae06b20181">setFunds</a>(20000);
<a name="l00466"></a>00466             <span class="keywordflow">break</span>;
<a name="l00467"></a>00467         <span class="keywordflow">case</span> SC_RIO:
<a name="l00468"></a>00468             name = <span class="stringliteral">"Rio de Janeiro"</span>;
<a name="l00469"></a>00469             fname = <span class="stringliteral">"snro.888"</span>;
<a name="l00470"></a>00470             <a class="code" href="classMicropolis.html#2ef685b0d3c202a6d03e62d6d745449b" title="Scenario being played.">scenario</a> = SC_RIO;
<a name="l00471"></a>00471             <a class="code" href="classMicropolis.html#559deb21709590d2d08e21da2dfb0518">cityTime</a> = ((2047 - 1900) * 48) + 2;
<a name="l00472"></a>00472             <a class="code" href="classMicropolis.html#85129802f6c58308373d25ae06b20181">setFunds</a>(20000);
<a name="l00473"></a>00473             <span class="keywordflow">break</span>;
<a name="l00474"></a>00474         <span class="keywordflow">default</span>:
<a name="l00475"></a>00475             <a class="code" href="micropolis_8h.html#6c2edf1e500e498b687567418bf4fef6">NOT_REACHED</a>();
<a name="l00476"></a>00476             <span class="keywordflow">break</span>;
<a name="l00477"></a>00477     }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     <a class="code" href="classMicropolis.html#d8c052cd92e97f05a54a4433324a6e6a">setCleanCityName</a>(name);
<a name="l00480"></a>00480     setSpeed(3);
<a name="l00481"></a>00481     setCityTax(7);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <a class="code" href="classMicropolis.html#dbc19c162ac05f3ab6f536274a4b7547">loadFileDir</a>(
<a name="l00484"></a>00484         fname,
<a name="l00485"></a>00485         <a class="code" href="classMicropolis.html#9fac09767a97060b673869135cd1977e">resourceDir</a>.c_str());
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <a class="code" href="classMicropolis.html#db7f55e6134a7f9a5224facf9dc51c6c">initWillStuff</a>();
<a name="l00488"></a>00488     initFundingLevel();
<a name="l00489"></a>00489     <a class="code" href="classMicropolis.html#86ae8470f3b07e64f8ae0a652e50945b">updateFunds</a>();
<a name="l00490"></a>00490     <a class="code" href="classMicropolis.html#ca92337e6e069e3ca61396b0e2604d8e">invalidateMaps</a>();
<a name="l00491"></a>00491     initSimLoad = 1;
<a name="l00492"></a>00492     <a class="code" href="classMicropolis.html#0fc9175e49a0b73af99ff1252fe1cf5c" title="Need to perform initial city evaluation.">doInitialEval</a> = <span class="keyword">false</span>;
<a name="l00493"></a>00493     <a class="code" href="classMicropolis.html#fe8a202062ffa639e0f0a77df48c7b42">doSimInit</a>();
<a name="l00494"></a>00494     <a class="code" href="classMicropolis.html#b39b9aada00739647582f1430605c368">didLoadScenario</a>();
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 
<a name="l00499"></a><a class="code" href="classMicropolis.html#b39b9aada00739647582f1430605c368">00499</a> <span class="keywordtype">void</span> <a class="code" href="classMicropolis.html#b39b9aada00739647582f1430605c368">Micropolis::didLoadScenario</a>()
<a name="l00500"></a>00500 {
<a name="l00501"></a>00501     <a class="code" href="classMicropolis.html#7c82ad1284fbd0a19b1b70f998d600c4">callback</a>(<span class="stringliteral">"didLoadScenario"</span>, <span class="stringliteral">""</span>);
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00513"></a><a class="code" href="classMicropolis.html#d7c2148ccca8aaebdf48916a37174527">00513</a> <span class="keywordtype">bool</span> <a class="code" href="classMicropolis.html#d7c2148ccca8aaebdf48916a37174527">Micropolis::loadCity</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)
<a name="l00514"></a>00514 {
<a name="l00515"></a>00515     <span class="keywordflow">if</span> (<a class="code" href="classMicropolis.html#a15ca2a508026c76965ceefcf01fdd8b">loadFile</a>(filename)) {
<a name="l00516"></a>00516 
<a name="l00517"></a>00517         <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a> = filename;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastSlash = <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.find_last_of(<span class="charliteral">'/'</span>);
<a name="l00520"></a>00520         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos = (lastSlash == std::string::npos) ? 0 : lastSlash + 1;
<a name="l00521"></a>00521 
<a name="l00522"></a>00522         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastDot = <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.find_last_of(<span class="charliteral">'.'</span>);
<a name="l00523"></a>00523         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> last =
<a name="l00524"></a>00524             (lastDot == std::string::npos) ? <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.length() : lastDot;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         std::string newCityName = <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.substr(pos, last - pos);
<a name="l00527"></a>00527         setCityName(newCityName);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         <a class="code" href="classMicropolis.html#787631bcdb4a9eee5c938d760506b1ea">didLoadCity</a>();
<a name="l00530"></a>00530 
<a name="l00531"></a>00531         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     } <span class="keywordflow">else</span> {
<a name="l00534"></a>00534 
<a name="l00535"></a>00535         <a class="code" href="classMicropolis.html#449879ae7a7c9e2549389b6d5a45b256">didntLoadCity</a>((filename &amp;&amp; *filename) ? filename : <span class="stringliteral">"(null)"</span>);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540 }
<a name="l00541"></a>00541 
<a name="l00543"></a><a class="code" href="classMicropolis.html#787631bcdb4a9eee5c938d760506b1ea">00543</a> <span class="keywordtype">void</span> <a class="code" href="classMicropolis.html#787631bcdb4a9eee5c938d760506b1ea">Micropolis::didLoadCity</a>()
<a name="l00544"></a>00544 {
<a name="l00545"></a>00545     <a class="code" href="classMicropolis.html#7c82ad1284fbd0a19b1b70f998d600c4">callback</a>(<span class="stringliteral">"didLoadCity"</span>, <span class="stringliteral">""</span>);
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 
<a name="l00553"></a><a class="code" href="classMicropolis.html#449879ae7a7c9e2549389b6d5a45b256">00553</a> <span class="keywordtype">void</span> <a class="code" href="classMicropolis.html#449879ae7a7c9e2549389b6d5a45b256">Micropolis::didntLoadCity</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg)
<a name="l00554"></a>00554 {
<a name="l00555"></a>00555     <a class="code" href="classMicropolis.html#7c82ad1284fbd0a19b1b70f998d600c4">callback</a>(<span class="stringliteral">"didntLoadCity"</span>, <span class="stringliteral">"s"</span>, msg);
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 
<a name="l00564"></a><a class="code" href="classMicropolis.html#44d47073abdffada381b2803c3bda76c">00564</a> <span class="keywordtype">void</span> <a class="code" href="classMicropolis.html#44d47073abdffada381b2803c3bda76c">Micropolis::saveCity</a>()
<a name="l00565"></a>00565 {
<a name="l00566"></a>00566     <span class="keywordflow">if</span> (<a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.length() &gt; 0) {
<a name="l00567"></a>00567 
<a name="l00568"></a>00568         <a class="code" href="classMicropolis.html#bf1fc85cf480d5f462b7378c2aecd768">doSaveCityAs</a>();
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     } <span class="keywordflow">else</span> {
<a name="l00571"></a>00571         <span class="keywordflow">if</span> (<a class="code" href="classMicropolis.html#6b81a4a5dda6fa2b37c0e3a744ffd94d">saveFile</a>(<a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.c_str())) {
<a name="l00572"></a>00572 
<a name="l00573"></a>00573             <a class="code" href="classMicropolis.html#b197b1f4e89165c7171d4ae65a2be0aa">didSaveCity</a>();
<a name="l00574"></a>00574 
<a name="l00575"></a>00575         } <span class="keywordflow">else</span> {
<a name="l00576"></a>00576 
<a name="l00577"></a>00577             <a class="code" href="classMicropolis.html#ec3c299761d649422d4378e6198c39aa">didntSaveCity</a>(<a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.c_str());
<a name="l00578"></a>00578 
<a name="l00579"></a>00579         }
<a name="l00580"></a>00580     }
<a name="l00581"></a>00581 }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 
<a name="l00585"></a><a class="code" href="classMicropolis.html#bf1fc85cf480d5f462b7378c2aecd768">00585</a> <span class="keywordtype">void</span> <a class="code" href="classMicropolis.html#bf1fc85cf480d5f462b7378c2aecd768">Micropolis::doSaveCityAs</a>()
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587     <a class="code" href="classMicropolis.html#7c82ad1284fbd0a19b1b70f998d600c4">callback</a>(<span class="stringliteral">"saveCityAs"</span>, <span class="stringliteral">""</span>);
<a name="l00588"></a>00588 }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 
<a name="l00592"></a><a class="code" href="classMicropolis.html#b197b1f4e89165c7171d4ae65a2be0aa">00592</a> <span class="keywordtype">void</span> <a class="code" href="classMicropolis.html#b197b1f4e89165c7171d4ae65a2be0aa">Micropolis::didSaveCity</a>()
<a name="l00593"></a>00593 {
<a name="l00594"></a>00594     <a class="code" href="classMicropolis.html#7c82ad1284fbd0a19b1b70f998d600c4">callback</a>(<span class="stringliteral">"didSaveCity"</span>, <span class="stringliteral">""</span>);
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 
<a name="l00602"></a><a class="code" href="classMicropolis.html#ec3c299761d649422d4378e6198c39aa">00602</a> <span class="keywordtype">void</span> <a class="code" href="classMicropolis.html#ec3c299761d649422d4378e6198c39aa">Micropolis::didntSaveCity</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg)
<a name="l00603"></a>00603 {
<a name="l00604"></a>00604     <a class="code" href="classMicropolis.html#7c82ad1284fbd0a19b1b70f998d600c4">callback</a>(<span class="stringliteral">"didntSaveCity"</span>, <span class="stringliteral">"s"</span>, msg);
<a name="l00605"></a>00605 }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607 
<a name="l00615"></a><a class="code" href="classMicropolis.html#e5b7e3f82e0ce4b2fd2d136b8827631b">00615</a> <span class="keywordtype">void</span> <a class="code" href="classMicropolis.html#e5b7e3f82e0ce4b2fd2d136b8827631b">Micropolis::saveCityAs</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617     <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a> = filename;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="keywordflow">if</span> (<a class="code" href="classMicropolis.html#6b81a4a5dda6fa2b37c0e3a744ffd94d">saveFile</a>(<a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.c_str())) {
<a name="l00620"></a>00620 
<a name="l00621"></a>00621         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastDot = <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.find_last_of(<span class="charliteral">'.'</span>);
<a name="l00622"></a>00622         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastSlash = <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.find_last_of(<span class="charliteral">'/'</span>);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos =
<a name="l00625"></a>00625             (lastSlash == std::string::npos) ? 0 : lastSlash + 1;
<a name="l00626"></a>00626         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> last =
<a name="l00627"></a>00627             (lastDot == std::string::npos) ? <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.length() : lastDot;
<a name="l00628"></a>00628         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len =
<a name="l00629"></a>00629             last - pos;
<a name="l00630"></a>00630         std::string newCityName =
<a name="l00631"></a>00631             <a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.substr(pos, len);
<a name="l00632"></a>00632 
<a name="l00633"></a>00633         setCityName(newCityName);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635         <a class="code" href="classMicropolis.html#b197b1f4e89165c7171d4ae65a2be0aa">didSaveCity</a>();
<a name="l00636"></a>00636 
<a name="l00637"></a>00637     } <span class="keywordflow">else</span> {
<a name="l00638"></a>00638 
<a name="l00639"></a>00639         <a class="code" href="classMicropolis.html#ec3c299761d649422d4378e6198c39aa">didntSaveCity</a>(<a class="code" href="classMicropolis.html#4658e7cf85dc59adaa6ea74faf5a4f2c" title="Filename of the last loaded city.">cityFileName</a>.c_str());
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Feb 2 09:19:22 2011 for Micropolis by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
